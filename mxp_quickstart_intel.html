<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>VectorBlox MXP Quickstart for Intel</title>
  <style type="text/css">code{white-space: pre;}</style>
<link type="text/css" rel="stylesheet" href="css/bootstrap.css"/>
<link type="text/css" rel="stylesheet" href="css/jquery.ui.all.css"/>
<link type="text/css" rel="stylesheet" href="css/jquery.tocify.css"/>
<style>
body {
    padding-top: 20px;
}
p {
    font-size: 16px;
}
.headerDoc {
    color: #005580;
}

@media (max-width: 767px) {
    #toc {
        position: relative;
        width: 100%;
        margin: 0px 0px 20px 0px;
    }
}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-48667957-1', 'vectorblox.github.io');
  ga('send', 'pageview');

</script>
</head>
<body>
<div class="container-fluid">
<div class="row-fluid">
<div class="span3">
<div id="toc"></div>
</div>
<div class="span9">
<div id="header">
<h1 class="title">VectorBlox MXP Quickstart for Intel</h1>
</div>
<h1 id="beforeyoubegin"><span class="header-section-number">1</span> Before You Begin</h1>
<p>If you do not have a MXP license, or are only intererested in software development, skip over the hardware specific sections.</p>
<h1 id="quickstart_install"><span class="header-section-number">2</span> Installation</h1>
<p>This guide describes installing VectorBlox MXP to run with Qsys and the Intel Nios II Embedded Design Suite (EDS).</p>
<h2 id="installation_prerequisites"><span class="header-section-number">2.1</span> Prerequisites</h2>
<p>Before you begin, make sure you have:</p>
<ul>
<li><p>Intel Quartus Prime, version 17.1. Download it from <a href="http://www.altera.com/download/dnl-index.jsp">Intel</a>. The VectorBlox MXP will likely work with older or newer versions of Quartus</p></li>
<li><p><strong>For releases containing the SDK and hardware IP:</strong> The VectorBlox MXP Software Development Kit (SDK) and encrypted MXP IP core , provided as a <code>.zip</code> file.</p></li>
<li><p><strong>For releases containing only the SDK:</strong> The VectorBlox MXP Software Development Kit (SDK), provided as a <code>.zip</code> file.</p></li>
<li><p>One of the supported development boards, if you want to use one of the pre-built FPGA bitstreams included in the SDK.</p></li>
</ul>
<h2 id="installation_installing"><span class="header-section-number">2.2</span> Installing</h2>
<ul>
<li><p>Install Intel Quartus Prime software according to Intel's instructions.</p>
<p><a href="http://www.altera.com/download/dnl-index.jsp">http://www.altera.com/download/dnl-index.jsp</a></p>
<p>Note the pathname where these tools are installed. For example, under Windows, the default install location for version 17.1 is <code>C:\intelFPGA\17.1\quartus</code> and the environment variable <code>QUARTUS_ROOTDIR</code> will be set to this location.</p></li>
<li><p>Follow Altera's instructions for installing the USB Blaster device driver.</p>
<p><a href="http://www.altera.com/download/drivers/dri-index.html">http://www.altera.com/download/drivers/dri-index.html</a></p></li>
<li><p>Copy vectorblox/repository/altera/mxp into <code>QUARTUS_ROOTDIR/../ip/vectorblox/</code>. You may have to create that directory.</p></li>
</ul>
<p>To install the license file (provided separately) for the hardware IP, please refer to the <a href="http://www.altera.com/literature/manual/quartus_install.pdf">Intel FPGA Software Installation and Licensing</a>.</p>
<h1 id="quickstart_hardware"><span class="header-section-number">3</span> Hardware</h1>
<p>A VectorBlox MXP system always uses a host CPU. This host CPU provides the MXP with instructions, and run the unaccelerated portions of your C/C++ application.</p>
<p>This section describes how to instantiate the VectorBlox MXP processor into a Qsys system. Some familiarity with Qsys is assumed; please refer to the <em>System Design with Qsys</em> section of the <a href="https://www.altera.com/en_US/pdfs/literature/hb/qts/qts-qps-handbook.pdf">Quartus II Handbook</a> for further details on Qsys.</p>
<p>You must ensure that the VectorBlox components are in the Qsys IP Search Path. If you extracted the Vectorblox MXP distribution into <code>QUARTUS_ROOTDIR/../ip</code> or into the <code>ip</code> subdirectory of your Quartus project, Qsys will be able find the VectorBlox components automatically. Otherwise, you can add a directory to the IP Search Path in Qsys; from the <strong><em>Tools</em></strong> menu, open the <strong><em>Options</em></strong> dialog box.</p>
<div class="figure">
<img src="images/qsys_component_library.png" alt="Qsys Component Library" /><p class="caption">Qsys Component Library</p>
</div>
<p>The figure above shows the VectorBlox components in the Qsys IP Catalog.</p>
<h2 id="vectorblox_mxp_qsys_parameters"><span class="header-section-number">3.1</span> VectorBlox MXP Qsys Parameters</h2>
<p>To add a VectorBlox MXP instance to your Qsys system, double-click on <strong><em>VectorBlox MXP</em></strong>. Qsys will open the parameter editor shown in the figure. The parameters are described below.</p>
<div class="figure">
<img src="images/qsys_mxp_parameters.png" alt="MXP Configuration Window" /><p class="caption">MXP Configuration Window</p>
</div>
<h4 id="number-of-vector-lanes"><span class="header-section-number">3.1.0.1</span> Number of Vector Lanes</h4>
<blockquote>
<p>The number of 32-bit vector lanes. This must be a power of 2. Each vector lane requires about the same amount of resources as the Nios II/f host CPU.</p>
</blockquote>
<h4 id="number-of-memory-lanes"><span class="header-section-number">3.1.0.2</span> Number of Memory Lanes</h4>
<blockquote>
<p>The data bus width of the MXP DMA Engine's Avalon-MM master interface expressed in terms of 32-bit lanes. The number of memory lanes must be a power of two and no larger than the number of vector lanes. For best performance, the width of this interface should match the width of the Avalon slave port of the external memory controller.</p>
</blockquote>
<h4 id="maximum-burst-size-in-beats"><span class="header-section-number">3.1.0.3</span> Maximum Burst Size in Beats</h4>
<blockquote>
<p>The maximum number of beats per burst issued by the DMA Engine's Avalon-MM master interface. A beat is a clock cycle in which data is transferred between a master and slave interface. Using a larger value can improve the bandwidth between the MXP and slave devices. However, a very large value could potentially starve other masters (such as a Nios II/f host) from accessing a slave. Likewise, very small values will divide long transfers into very short bursts, losing potential bandwidth during the gaps.</p>
</blockquote>
<h4 id="scratchpad-size"><span class="header-section-number">3.1.0.4</span> Scratchpad Size</h4>
<blockquote>
<p>The Scratchpad RAM size in kilobytes. VectorBlox recommends 4KB per vector lane for most applications.</p>
</blockquote>
<h4 id="instruction-port-type"><span class="header-section-number">3.1.0.5</span> Instruction Port Type</h4>
<blockquote>
<p>The MXP can be controlled using several different instruction ports. To connect an ARM host processor to the MXP use the AXI Memory Mapped Port. To connect A NIOS II host processor to the MXP use the Nios Custom Instruction Port. The Vector Coprocessor Port is for connecting the MXP to the VectoBlox ORCA, a RISC-V based processor.</p>
</blockquote>
<h4 id="multiplier-performance"><span class="header-section-number">3.1.0.6</span> Multiplier Performance</h4>
<blockquote>
<p>This sets the minimum multiplier size. This can be used to reduce the number of hard multipliers used, at the cost of performance. If set to <em>Byte</em>, then byte, halfword, and word multipliers are instantiated and multiplication of any element size runs at full speed. If set to <em>Halfword</em>, only word and halfword multipliers are instantiated; byte-width multiplication will be executed with the halfword multiplier and run at half speed. If set to <em>Word</em>, only word multipliers are instantiated; halfword-width multiplication will run at half speed and byte-width multiplication will run at quarter speed.</p>
</blockquote>
<h4 id="maximum-number-of-waves-for-masked-instructions"><span class="header-section-number">3.1.0.7</span> Maximum number of waves for masked instructions</h4>
<blockquote>
<p>The maximum vector length that a masked instuction can be is calculated from this value. The Number of Vector Lanes multiplied by this value gives the maximum vector length for a word instruction. Multiply that product by 2 and 4 to get the max vector length for halfword and byte instructions respectively.</p>
</blockquote>
<h4 id="fixed-point-multiply-format"><span class="header-section-number">3.1.0.8</span> Fixed-Point Multiply Format</h4>
<blockquote>
<p>These parameters affect the fixed-point multiply operation. They specify the number of least-significant bits that will be used to represent the fractional part of 32-bit, 16-bit, and 8-bit fixed-point numbers.</p>
<p>The fixed-point formats are also displayed in Q notation, where the first number specifies the number of integer bits and the second number specifies the number of fractional bits.</p>
<p>Fixed-point formats with no integer bits (Q0.X) are not allowed. Multiply high (VMULHI) is equivalent to fixed-point multiply for these formats and should be used instead.</p>
</blockquote>
<p>Below the editable parameters are the Derived Avalon Parameters, which show the inferred widths of various Avalon ports:</p>
<h4 id="dma-master-data-bus-width"><span class="header-section-number">3.1.0.9</span> DMA Master Data Bus Width</h4>
<blockquote>
<p>The data bus width, in bits, of the DMA Engine's Avalon-MM master interface. This is derived from the number of memory lanes.</p>
</blockquote>
<h4 id="dma-master-burst-size"><span class="header-section-number">3.1.0.10</span> DMA Master Burst Size</h4>
<blockquote>
<p>The Avalon-MM master interface's maximum burst size in bytes, as determined by the memory bus width and the maximum number of beats per burst.</p>
</blockquote>
<h4 id="dma-master-burstcount-width"><span class="header-section-number">3.1.0.11</span> DMA Master Burstcount Width</h4>
<blockquote>
<p>The width of the Avalon-MM master interface's <code>burstcount</code> output, as determined by the maximum burst size and the memory bus width.</p>
</blockquote>
<h4 id="slave-address-width"><span class="header-section-number">3.1.0.12</span> Slave Address Width</h4>
<blockquote>
<p>The MXP's Avalon-MM slave address width as determined by the scratchpad size.</p>
</blockquote>
<h2 id="qsys_connections"><span class="header-section-number">3.2</span> Qsys Connections</h2>
<p>This section describes the MXP processor's interfaces, shown in the figure below.</p>
<div class="figure">
<img src="images/qsys_ncs_connection.png" />
</div>
<h4 id="ncs"><span class="header-section-number">3.2.0.1</span> ncs</h4>
<blockquote>
<p>The MXP connects to the Nios II CPU through through a custom instruction port Make sure the Opcode base is set to 0.</p>
</blockquote>
<h4 id="axi_instr_slave"><span class="header-section-number">3.2.0.2</span> axi_instr_slave</h4>
<blockquote>
<p>When Using an ARM as a host processor, connect the MXP to the processor via the axi memory mapped slave.</p>
</blockquote>
<h4 id="dma_master"><span class="header-section-number">3.2.0.3</span> dma_master</h4>
<blockquote>
<p>This is the MXP DMA Engine's interface to external memory. The data bus width is determined by the number of memory lanes selected in the MXP Parameter Editor.</p>
</blockquote>
<h4 id="scratchpad_slave"><span class="header-section-number">3.2.0.4</span> scratchpad_slave</h4>
<blockquote>
<p>This slave interface provides external access to the MXP's scratchpad memory. The address width is determined by the scratchpad size.</p>
</blockquote>
<h4 id="core_clk"><span class="header-section-number">3.2.0.5</span> core_clk</h4>
<blockquote>
<p>This is the main MXP clock. The MXP's Avalon Memory Mapped Master and Slave interfaces run synchronously to <strong>core_clk</strong>. <strong>core_clk</strong> has to be synchronous to the Nios II CPU clock.</p>
</blockquote>
<h4 id="core_clk_2x"><span class="header-section-number">3.2.0.6</span> core_clk_2x</h4>
<blockquote>
<p>This clock must be double the frequency of <strong>core_clk</strong> and must be synchronous to <strong>core_clk</strong>. It should be generated from the same PLL that provides <strong>core_clk</strong>.</p>
</blockquote>
<h4 id="core_reset"><span class="header-section-number">3.2.0.7</span> core_reset</h4>
<blockquote>
<p>This is the active high reset input. Assertion and deassertion must be synchronous to <strong>core_clk</strong> and <strong>core_clk_2x</strong>.</p>
</blockquote>
<h2 id="qsys_system_generation"><span class="header-section-number">3.3</span> Qsys System Generation</h2>
<p>Once all of the components in your Qsys system have their interfaces connected correctly, you can proceed to Qsys generation by clicking on the <em>Generation</em> tab, setting options, then clicking <em>Generate</em>.</p>
<p>To generate synthesizable HDL, check <strong><em>Create HDL design files for synthesis</em></strong> in the Synthesis subsection.</p>
<p>To generate a simulation model, you must have a VectorBlox license that supports IP Functional Simulation (IPFS) model generation in either Verilog or VHDL (or both). If your license supports it, select either Verilog or VHDL from the <strong><em>Create Simulation Model</em></strong> drop-down menu in the Simulation subsection.</p>
<h1 id="quickstart_software"><span class="header-section-number">4</span> Software</h1>
<p>This section describes how to download one of the provided pre-built FPGA bitstreams to a development board and how to compile and run a test program on it.</p>
<p>The string <strong>EXAMPLES</strong> refers to the <code>examples</code> subdirectory of the extracted release.</p>
<h2 id="software_prerequisites"><span class="header-section-number">4.1</span> Prerequisites</h2>
<p>Before you begin, make sure you have:</p>
<ul>
<li><p>Installed IntelFPGA Quartus Prime 17.1</p>
<p>Quartus Prime 17.1 is the currently recommended version, as this is the version that was used to create the pre-built bitstreams and BSPs, but the the VectorBlox MXP IP will likely work with other versions of Quartus</p></li>
<li><p>Installed and tested the USB Blaster device driver.</p></li>
<li><p>A supported development board. See the contents of <code>EXAMPLES/boards/</code>.</p></li>
<li><p>Connected your development board to your computer via USB cable.</p></li>
</ul>
<h2 id="software_configuring"><span class="header-section-number">4.2</span> Configuring the board</h2>
<ol style="list-style-type: decimal">
<li><p><strong>Start a Nios II Command Shell</strong></p>
<p>This sets up the proper environment variables for using the Nios II compiler system. Under Windows, this is a bash-shell under the Cygwin environment.</p></li>
<li><p><strong>Connect to the board</strong></p>
<p>Run <code>jtagconfig</code> which finds the USB Blaster and connects to the development board. If the response is &quot;No JTAG hardware available,&quot; be sure the USB cable is connected and the board is turned on.</p>
<p>If more than one board is connected, the target cable will have to be specified in all the commands below, adding <code>-c CABLE_NUM</code> to each command.</p></li>
<li><p><strong>Configure the FPGA</strong></p>
<p>Navigate to one of the prebuilt VectorBlox MXP systems for your development board, located in <code>EXAMPLES/boards/&lt;board_name&gt;/prebuilt_*</code>.</p>
<p>For example, for the DE2-115 board, change directory to <code>EXAMPLES/boards/de2_115/prebuilt_de2_115_v16</code> for a 16-lane MXP system.</p>
<p>From here, download the <code>.sof</code> file to the FPGA board using the command line:</p>
<pre><code>quartus_pgm -m JTAG -o P\;vblox1.sof</code></pre>
<p>Alternatively, you may start the GUI using <code>quartus_pgmw</code>, press <strong><em>Add File...</em></strong> and choose the <code>.sof</code> file, press <strong><em>Hardware Setup...</em></strong> and choose <strong><em>USB Blaster</em></strong> in the pulldown list, and finally press the <strong><em>Start</em></strong> button.</p>
<p>Now, assuming you are still in the directory containing the SOF, store the absolute path of the pre-built system's Board Support Package in a shell variable. This will save typing later. In Linux, run</p>
<pre><code>PROJ_ROOT=`pwd`</code></pre>
<p>In Windows, Windows-style paths are expected by Altera's software Makefiles, so instead use</p>
<pre><code>PROJ_ROOT=`cygpath -wa .`</code></pre></li>
</ol>
<h2 id="software_running"><span class="header-section-number">4.3</span> Running the software</h2>
<ol style="list-style-type: decimal">
<li><p><strong>Make the executable</strong></p>
<p>Navigate to a test application such as <code>vbw_vec_add_t</code>, located in <code>EXAMPLES/software/bmark/vbw_vec_add_t</code>.</p>
<p>To compile the program for the FPGA bitstream you previously selected, you need to pass the absolute path of the BSP to <code>make</code>. Assuming you have already saved this path in the <code>BSP_ROOT_DIR</code> shell variable as described earlier, you can run</p>
<pre><code>make clean_all all BSP_ROOT_DIR=$BSP_ROOT_DIR</code></pre>
<p>After a long list of messages and a few seconds, the file <code>test.elf</code> should have been created. If you receive the error &quot;../vblox1.sopcinfo has been modified since the BSP was generated.&quot;, run the command <code>touch $BSP_ROOT_DIR/public.mk</code> to resolve it.</p>
<p>Note that we used the <code>clean_all</code> target first to ensure that any libraries that might have been compiled against a different BSP in the past were cleaned and re-compiled. If you know that the libraries were already compiled for the selected BSP, you can omit the <code>clean_all</code> target.</p></li>
<li><p><strong>Download the executable</strong></p>
<p>Download and run the executable from the command line:</p>
<pre><code>nios2-download -g -r test.elf</code></pre>
<p>After the download completes, the flag <code>-r</code> resets the Nios II computer system, and the flag <code>-g</code> tells the computer to 'go' or execute the program.</p></li>
<li><p><strong>View execution output</strong></p>
<p>The executable may use stdin or stdout for <code>printf()</code>, <code>scanf()</code>, and similar functions. A terminal emulator can connect with the Nios II computer system to provide this I/O behaviour by running</p>
<pre><code>nios2-terminal</code></pre>
<p>If the Nios II program wants to disconnect with the terminal, it can print an EOT (end of transmission) character with</p>
<pre><code>putchar(4);</code></pre>
<p>To disconnect manually host-side, type <code>C-c</code>. Note that Control-C does not actually stop the application from running. However, with the <code>nios2-terminal</code> disconnected, the application may eventually block if it fills its <code>printf()</code> buffer and cannot flush the output device.</p></li>
</ol>
</div>
</div>
</div>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/jquery.tocify.min.js"></script>
<script>
$(function() {
    var toc = $("#toc").tocify({
        selectors: "h1, h2",
        history: false,
        smoothScrollSpeed: "fast",
        }).data("toc-tocify");
      $(".optionName").popover({ trigger: "hover" });
});
</script>
</body>
</html>
